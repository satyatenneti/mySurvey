<apex:page showHeader="true" sidebar="false" standardStylesheets="false" controller="SendSurveyController">
<c:ScriptIncludes />
<apex:stylesheet value="{!URLFOR($Resource.Styles, 'styles/custom/globalCSS.css')}"/>
<apex:stylesheet value="{!URLFOR($Resource.Styles, 'styles/custom/sendSurveyCSS.css')}"/>
<apex:form id="sendSurvey">
    <div class="form-container">
        <div><apex:pageMessages /></div>
        <div class="font-large bold-text margin-10px">{!survey.Name}</div>
        <hr />
        <table class="table">
            <tr><th colspan="2" style="float: right;">
                <select id="send-form-to-select" class="select-box">
                        <option value="">Send form to</option> 
                        <option value="users">Users</option> 
                        <option value="contacts">Contacts</option> 
                        <option value="groups">Groups</option> 
                        <option value="others">Others</option> 
                </select></th>
            </tr>
           <tr>
                <td><div id="users" class="section" style="display: none;">


                    <table id="usertable" class="display">
                        <thead>
                            <tr>
                                <th></th>
                                <th>First Name</th>
                                <th>Last Name</th>
                                <th>Image</th>
                            </tr>
                        </thead>
                        <tbody>
                            <apex:repeat value="{!userDetailsList}" var="userDetail">
                                <tr>
                                    <td><apex:inputCheckbox value="{!userDetail.selected}"  /></td> 
                                    <td>{!userDetail.user.FirstName}</td>
                                    <td>{!userDetail.user.LastName}</td>
                                    <td><apex:image url="{!userDetail.user.smallphotourl}" /></td>
                                </tr>
                            </apex:repeat>
                        </tbody>
                    </table>
                    <apex:outputPanel rendered="{!userDetailsList.size == 0}">No Users exist.</apex:outputPanel>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div id="contacts" class="section" style="display: none;">

                        <table id="contacttable" class="display">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th>First Name</th>
                                    <th>Last Name</th>
                                </tr>
                            </thead>
                            <tbody>
                                <apex:repeat value="{!contactDetailsList}" var="contactDetail">
                                    <tr>
                                        <td><apex:inputCheckbox value="{!contactDetail.selected}"  /></td> 
                                        <td>{!contactDetail.contact.FirstName}</td>
                                        <td>{!contactDetail.contact.LastName}</td>
                                    </tr>
                                </apex:repeat>
                            </tbody>
                        </table>
                        <apex:outputPanel rendered="{!contactDetailsList.size == 0}">No Contacts exist.</apex:outputPanel>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div id="groups" class="section" style="display: none;">
                        <apex:outputPanel rendered="{! groupsList.size != 0}">
                                <label class="bold-text">Select Groups</label>
                                <apex:selectList styleClass="sender-list ui-selectmenu-button ui-widget ui-state-default ui-corner-top" style="overflow:auto" id="select-groups" size="5" value="{!selectedGroups}" multiselect="true">
                                    <apex:selectOptions value="{!groupsList}"/>
                                </apex:selectList>
                        </apex:outputPanel>
                        <apex:outputPanel rendered="{!groupsList.size == 0}">No Groups exist.</apex:outputPanel>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <div id="others" class="section" style="display: none;">
                        <span>You have
                            <apex:outputLabel rendered="{! balanceEmails != 0}"> {!balanceEmails} </apex:outputLabel>
                            <apex:outputLabel rendered="{!balanceEmails == 0}"> no </apex:outputLabel>
                          mails left for the day</span><br/>
                        <apex:outputPanel rendered="{! balanceEmails != 0}">
                            <label class="bold-text">External Emails</label><br/ >
                            <label class="small-text">Please select list of comma seperated email ids.</label>
                            <br />
                            <apex:inputTextarea id="external-emails" value="{!externalContacts}" rows="5"  cols="100" /> 
                        </apex:outputPanel><br/>
                        <span id="email-error" class="error" style="display: none;">Invalid Email Ids</span>
                    </div>
                </td>
            </tr>
            <tr><td>
                    <apex:outputPanel >
                        <input type="button" style="display: none;" class="control-button" value="Send Form" onclick="doValidateAndSendForm()" />
                    </apex:outputPanel>
                </td>
            </tr>
        </table>
    </div>
    <apex:inputHidden value="{!sendTo}" id="sendTo"/>
    <apex:actionFunction action="{!sendForm}" name="sendSurveyForm" />
</apex:form>
<apex:includeScript value="{!URLFOR($Resource.CustomScripts, 'customscripts/sendSurveyJS.js')}"/>
</apex:page>