<apex:page standardController="Trifecta_Survey__c" sidebar="false"  extensions="TrifectaSurveyController">
    <apex:stylesheet value="{!URLFOR($Resource.JQuery, 'scripts/jquery-ui.css')}"/>
    <apex:includeScript value="{!URLFOR($Resource.JQuery, 'scripts/external/jquery/jquery.js')}"/>
    <apex:includeScript value="{!URLFOR($Resource.JQuery, 'scripts/jquery-ui.min.js')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.JQuery, 'scripts/custom/createSurveyCSS.css')}"/>
    <apex:form id="survey">
        <div class="form-container">
            <div class="section">
                <p><apex:inputText styleClass="ui-autocomplete-input ui-corner-all" value="{!survey.Name}" html-placeholder="Untitle Form"/></p>
                <p><apex:inputText styleClass="ui-autocomplete-input ui-corner-all" value="{!survey.Help_Text__c}" html-placeholder="Form Description"/></p>
            </div>
            <div class="section questions">
                <apex:actionfunction action="{!addNewSurveyQuestionChoice}" name="addNewSurveyQuestion" reRender="questions">
                    <apex:param name="questionloadId" value="" assignTo="{!questionloadId}"/>
                </apex:actionfunction>
                <apex:actionfunction action="{!sendSurvey}" name="sendSurvey" />
                <apex:actionfunction action="{!saveSurvey}" name="saveSurvey" />
                <apex:actionfunction action="{!addNewSurveyQuestion}" name="addNewQuestion" rerender="questions" />
                <apex:actionfunction action="{!deleteSurveyQuestion}" name="deleteQuestion" rerender="questions" >
                    <apex:param name="questionloadId"  value="" assignTo="{!questionloadId}"/>
                </apex:actionfunction>
                <apex:actionFunction name="deleteChoice" action="{!deleteSurveyQuestionChoice}" reRender="questions">
                    <apex:param name="questionloadId"  value="" assignTo="{!questionloadId}"/>
                    <apex:param name="choiceLoadId"  value="" assignTo="{!choiceLoadId}"/>
                </apex:actionFunction>
                <apex:actionfunction action="{!toggleQuestionEdit}" name="toggleQuestion" reRender="questions">
                    <apex:param name="questionloadId" value="" assignTo="{!questionloadId}"/>
                </apex:actionfunction>
                
                <apex:outputPanel id="questions">
                    <apex:repeat value="{!surveyQuestions}" var="question">
                        <apex:panelGroup rendered="{! (!question.isEdit__c)}">
                            <apex:panelGrid columns="1">
                                <apex:panelGrid columns="2">
                                    <apex:inputHidden />
                                    <apex:outputPanel rendered="{! (surveyQuestions.size != 1) }">
                                            <tr>
                                                <td colspan="4">
                                                    <ul class="control-buttons">
                                                        <li onclick="toggleQuestion('{!question.Load_Id__c}')" class="ui-state-default ui-corner-all" title=".ui-icon-pencil"><span class="ui-icon ui-icon-pencil pointer"></span></li>
                                                        <li class="ui-state-default ui-corner-all" title=".ui-icon-copy"><span class="ui-icon ui-icon-copy pointer"></span></li>
                                                        <li class="ui-state-default ui-corner-all" title=".ui-icon-trash"><span class="ui-icon ui-icon-trash pointer" onclick="deleteQuestion('{!question.Load_Id__c}')"></span></li>
                                                    </ul>
                                                </td>
                                            </tr>
                                    </apex:outputPanel>
                                </apex:panelGrid>
                                <apex:outputText value="{!question.Title__c}" />
                                <apex:outputText value="{!question.Help_text__c}" />
                                <apex:repeat value="{!surveyQuestionChoiceMap[question.Load_Id__c]}" var="choice"> 
                                    <apex:panelGrid columns="2" rendered="{! question.Type__c == 'Multi Choice'}">
                                        <apex:selectRadio disabled="true"/>
                                        <apex:outputText value="{! choice.Value__c}" />
                                    </apex:panelGrid>
                                    <apex:panelGrid columns="1" rendered="{! question.Type__c == 'Text'}">
                                        <apex:inputText />
                                    </apex:panelGrid>
                                    <apex:panelGrid columns="2" rendered="{! question.Type__c == 'Checkbox'}">
                                        <apex:selectCheckboxes disabled="true" />
                                        <apex:outputText value="{! choice.Value__c}" />
                                    </apex:panelGrid>
                                </apex:repeat>

                            </apex:panelGrid>
                        </apex:panelGroup>
                        <apex:panelGroup rendered="{!question.isEdit__c}">
                            <div class="question section">
                                <table class="table">
                                    <apex:outputPanel rendered="{! (surveyQuestions.size != 1) }">
                                        <tr>
                                            <td colspan="4">
                                                <ul class="control-buttons">
                                                    <li class="ui-state-default ui-corner-all" title=".ui-icon-pencil"><span class="ui-icon ui-icon-pencil pointer"></span></li>
                                                    <li class="ui-state-default ui-corner-all" title=".ui-icon-copy"><span class="ui-icon ui-icon-copy pointer"></span></li>
                                                    <li class="ui-state-default ui-corner-all" title=".ui-icon-trash"><span class="ui-icon ui-icon-trash pointer" onclick="deleteQuestion('{!question.Load_Id__c}')"></span></li>
                                                </ul>
                                            </td>
                                        </tr>
                                    </apex:outputPanel>
                                    <tr>
                                        <th><label>Question Title</label></th><td><apex:inputText styleClass="ui-corner-all" value="{!question.Title__c}" /></td>
                                    </tr>
                                    <tr>
                                        <th><label>Help Text</label></th><td><apex:inputText styleClass="ui-corner-all" value="{!question.Help_text__c}" /> </td>
                                    </tr>
                                    <tr>
                                        <th><label>Question Type</label></th><td><apex:inputField styleClass="ui-selectmenu-button ui-widget ui-state-default ui-corner-top" value="{!question.Type__c}"/></td>
                                    </tr>
                                    <tr>
                                        <th colspan=""></th>
                                        <td><div id="choices" class="choice">
                                            <apex:repeat value="{!surveyQuestionChoiceMap[question.Load_Id__c]}" var="choice"> 
                                                <apex:variable value="{!surveyQuestionChoiceMap[question.Load_Id__c]}" var="choiceList"/>
                                                <div>
                                                    <apex:inputText styleClass="ui-autocomplete-input ui-corner-all input-choice" value="{!choice.Value__c}" />
                                                    <apex:outputPanel rendered="{! (choiceList.size !=  1) }">
                                                        <span class="pointer x-box" onclick="deleteChoice('{!question.Load_Id__c}', '{!choice.Load_Id__c}')"> x </span>
                                                    </apex:outputPanel>
                                                    
                                                </div>
                                                
                                            </apex:repeat>
                                            <p><apex:inputText styleClass="grayed-out ui-autocomplete-input ui-corner-all" 
                                                               html-placeholder="Click to add new choice" html-readonly="true"  
                                                               onclick="addNewSurveyQuestion('{!question.Load_Id__c}')"/></p>   
                                            </div>
                                        </td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <th>
                                            <input type="button" class="control-button" value="Done" onclick="toggleQuestion('{!question.Load_Id__c}')" />
                                        </th>
                                        <th>
                                            <apex:inputCheckbox value="{!question.isRequired__c}"/>
                                            <label>Required question</label>
                                        </th>
                                    </tr>
                                </table>
                            </div>
                        </apex:panelGroup>
                    </apex:repeat>
                </apex:outputPanel>
                <input type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only ui-state-hover" value="Add  Question" onclick="addNewQuestion()"/>
            </div>
            <div class="section">
                <label>Confirmation Page</label>
                <p><apex:inputText value="{!survey.Auto_Response_Message__c}" html-placeholder="Thank you for your time and feedback."/></p>
            </div>
            <div class="section">
                <p><input type="button" value="Send Form" class="control-button" onclick="sendSurvey()" />
                    <input type="button" value="Save" class="control-button" onclick="saveSurvey()" /></p>
            </div>
        </div>
        
    </apex:form>
    
    
    <script>
    $(function() {
        $( "#sortable" ).sortable();
        $( "#sortable" ).disableSelection();
    });
    </script>
    
</apex:page>